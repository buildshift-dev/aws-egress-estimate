<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Architecture Network Diagram</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            color: white;
            overflow: hidden;
        }

        .header {
            background: rgba(0,0,0,0.4);
            padding: 15px 25px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(15px);
            z-index: 1000;
            position: relative;
        }

        .header h1 {
            font-size: 1.4rem;
            color: #3498db;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .controls {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            font-weight: 500;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(52,152,219,0.4);
        }

        .btn.secondary {
            background: #95a5a6;
        }

        .btn.secondary:hover {
            background: #7f8c8d;
        }

        .btn.accent {
            background: #e74c3c;
        }

        .btn.accent:hover {
            background: #c0392b;
        }

        #network-container {
            width: 100vw;
            height: calc(100vh - 70px);
            position: relative;
            overflow: hidden;
        }

        .org-section {
            position: absolute;
            border: 3px solid;
            border-radius: 15px;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.4s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 10;
        }

        .org-section:hover {
            transform: scale(1.02);
            background: rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .org-section.main-org {
            border-color: #3498db;
            left: 50px;
            top: 80px;
            width: 35%;
            height: 45%;
            padding: 10px;
        }

        .org-section.main-org .org-title {
            font-size: 1.6rem;
            margin-bottom: 10px;
        }

        .org-section.main-org .org-subtitle {
            font-size: 0.85rem;
            margin-bottom: 12px;
        }

        .org-section.main-org .org-stats {
            margin: 5px;
            padding: 8px;
        }

        .org-section.partner-org-1 {
            border-color: #e74c3c;
            right: 50px;
            top: 80px;
            width: 25%;
            height: 35%;
        }

        .org-section.partner-org-2 {
            border-color: #f39c12;
            right: 50px;
            bottom: 80px;
            width: 30%;
            height: 35%;
            padding: 10px;
        }

        .org-section.partner-org-2 .org-title {
            font-size: 1.6rem;
            margin-bottom: 10px;
        }

        .org-section.partner-org-2 .org-subtitle {
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .org-section.partner-org-2 .org-stats {
            margin: 5px;
            padding: 10px;
        }

        .org-section.hybrid-cloud {
            border-color: #9b59b6;
            left: 50px;
            top: calc(45% + 100px);
            width: 30%;
            height: 35%;
            background: rgba(155, 89, 182, 0.1) !important;
            padding: 10px;
        }

        .org-section.hybrid-cloud .org-title {
            font-size: 1.6rem;
            margin-bottom: 10px;
        }

        .org-section.hybrid-cloud .org-subtitle {
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .org-section.hybrid-cloud .org-stats {
            margin: 5px;
            padding: 10px;
        }

        .org-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .org-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .org-stats {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            margin: 8px;
        }

        .org-stats .stat {
            margin: 5px 0;
            font-size: 0.9rem;
        }

        .org-stats .cost {
            color: #f39c12;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .floating-connections {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 15;
        }

        .connection-line {
            stroke: #3498db;
            stroke-width: 3;
            stroke-dasharray: 10,5;
            opacity: 0.7;
            filter: drop-shadow(0 0 8px rgba(52,152,219,0.6));
            animation: pulse 3s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from { opacity: 0.4; stroke-width: 2; }
            to { opacity: 0.9; stroke-width: 4; }
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-radius: 15px;
            width: 90vw;
            height: 85vh;
            border: 3px solid #3498db;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-header {
            background: rgba(52,152,219,0.2);
            padding: 20px 25px;
            border-bottom: 2px solid rgba(52,152,219,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #3498db;
            font-weight: bold;
        }

        .modal-close {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .modal-body {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .node {
            cursor: pointer;
            stroke-width: 2px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
            transition: all 0.3s ease;
        }

        .node:hover {
            filter: drop-shadow(0 6px 16px rgba(0,0,0,0.5));
            transform: scale(1.15);
        }

        .node.highlighted {
            stroke: #f39c12 !important;
            stroke-width: 4px;
            filter: drop-shadow(0 0 20px rgba(243,156,18,0.8));
        }

        .node.dragging {
            stroke: #3498db !important;
            stroke-width: 5px;
            filter: drop-shadow(0 0 15px rgba(52,152,219,0.8)) brightness(1.3);
            transition: none; /* Disable transitions during drag for smooth movement */
            cursor: grabbing;
        }

        .link {
            stroke-opacity: 0.7;
            stroke-width: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .link:hover {
            stroke-opacity: 1;
            stroke-width: 4px;
        }

        .link.highlighted {
            stroke: #f39c12 !important;
            stroke-width: 5px;
            stroke-opacity: 1;
            filter: drop-shadow(0 0 10px rgba(243,156,18,0.8));
        }

        .node-label {
            font-family: 'Segoe UI', sans-serif;
            font-size: 10px;
            fill: white;
            text-anchor: middle;
            dominant-baseline: central;
            font-weight: 600;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
            pointer-events: none;
            user-select: none;
        }

        .cost-label {
            font-family: 'Segoe UI', sans-serif;
            font-size: 8px;
            fill: #f39c12;
            text-anchor: middle;
            dominant-baseline: central;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            pointer-events: none;
            user-select: none;
        }

        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.95);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.4;
            z-index: 3000;
            pointer-events: none;
            box-shadow: 0 8px 32px rgba(0,0,0,0.6);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.2);
            max-width: 320px;
            opacity: 0;
            transition: opacity 0.2s ease, transform 0.2s ease;
            transform: translateY(-5px);
        }

        .tooltip.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .tooltip h4 {
            color: #3498db;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .tooltip .cost {
            color: #f39c12;
            font-weight: bold;
            margin-top: 8px;
        }

        .legend {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(15px);
            border-radius: 10px;
            padding: 15px;
            border: 2px solid rgba(255,255,255,0.2);
            max-width: 280px;
            z-index: 100;
            text-align: center;
        }

        .legend h4 {
            color: #3498db;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.85rem;
            text-align: left;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            margin-right: 10px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .zoom-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .zoom-btn {
            width: 45px;
            height: 45px;
            background: rgba(52,152,219,0.9);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
        }

        .zoom-btn:hover {
            background: rgba(41,128,185,1);
            transform: scale(1.1);
        }

        @media (max-width: 1024px) {
            .org-section {
                position: relative;
                width: 90% !important;
                height: 200px !important;
                margin: 20px auto;
                left: auto !important;
                right: auto !important;
                top: auto !important;
                bottom: auto !important;
            }

            #network-container {
                height: auto;
                min-height: calc(100vh - 70px);
                padding: 20px;
                display: flex;
                flex-direction: column;
            }

            .floating-connections {
                display: none;
            }

            .legend {
                position: relative;
                margin: 20px auto;
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🏗️ Enterprise Multi-Organization Architecture Overview</h1>
        <div class="controls">
            <button class="btn" onclick="showCostAnalysis()">💰 Cost Analysis</button>
            <button class="btn accent" onclick="showAllConnections()">🔗 View All Connections</button>
            <a href="index.html" class="btn secondary">← Back to Estimator</a>
        </div>
    </div>

    <div id="network-container">
        <!-- Main Organization -->
        <div class="org-section main-org" onclick="showOrgDetails('main-org')">
            <div class="org-title" style="color: #3498db;">🏢 Main Organization</div>
            <div class="org-subtitle">
                Multi-region enterprise architecture spanning<br>
                US-East-1, EU-West-1, and AP-Southeast-1
            </div>
            <div class="org-stats">
                <div class="stat">📊 <strong>15 AWS Accounts</strong> across 3 regions</div>
                <div class="stat">🔗 <strong>25+ Data Connections</strong> with cost optimization</div>
                <div class="stat">💾 <strong>85,000 GB/month</strong> total traffic</div>
                <div class="cost">💰 $1,247/month data transfer costs</div>
            </div>
        </div>

        <!-- Partner Organization A -->
        <div class="org-section partner-org-1" onclick="showOrgDetails('partner-org-1')">
            <div class="org-title" style="color: #e74c3c;">🤝 Partner Org A</div>
            <div class="org-subtitle">
                External financial and analytics<br>
                service providers
            </div>
            <div class="org-stats">
                <div class="stat">🏦 <strong>FinTech Services</strong></div>
                <div class="stat">📈 <strong>Analytics Provider</strong></div>
                <div class="stat">💾 <strong>2,300 GB/month</strong></div>
                <div class="cost">💰 $30/month cross-org costs</div>
            </div>
        </div>

        <!-- Partner Organization B -->
        <div class="org-section partner-org-2" onclick="showOrgDetails('partner-org-2')">
            <div class="org-title" style="color: #f39c12;">🚚 Partner Org B</div>
            <div class="org-subtitle">
                Logistics and supply chain<br>
                integration partner
            </div>
            <div class="org-stats">
                <div class="stat">📦 <strong>Logistics Hub</strong></div>
                <div class="stat">🔗 <strong>Supply Chain Data</strong></div>
                <div class="stat">💾 <strong>1,000 GB/month</strong></div>
                <div class="cost">💰 $48/month hybrid costs</div>
            </div>
        </div>

        <!-- Hybrid Cloud Infrastructure -->
        <div class="org-section hybrid-cloud" onclick="showOrgDetails('hybrid-cloud')">
            <div class="org-title" style="color: #9b59b6;">☁️ Hybrid Cloud</div>
            <div class="org-subtitle">
                On-premises integration<br>
                and connectivity
            </div>
            <div class="org-stats">
                <div class="stat">🏢 <strong>Corporate HQ</strong></div>
                <div class="stat">🌐 <strong>5 Branch Offices</strong></div>
                <div class="stat">💾 <strong>3,300 GB/month</strong></div>
                <div class="cost">💰 $158/month connectivity</div>
            </div>
        </div>

        <!-- Floating connection lines -->
        <svg class="floating-connections">
            <defs>
                <marker id="arrowhead-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#e74c3c" />
                </marker>
                <marker id="arrowhead-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#f39c12" />
                </marker>
                <marker id="arrowhead-purple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#9b59b6" />
                </marker>
                <marker id="arrowhead-gray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#95a5a6" />
                </marker>
            </defs>
            <!-- Main to Partner A -->
            <line class="connection-line" x1="42%" y1="25%" x2="70%" y2="20%" stroke="#e74c3c" marker-end="url(#arrowhead-red)" />
            <!-- Main to Partner B -->
            <line class="connection-line" x1="42%" y1="35%" x2="65%" y2="78%" stroke="#f39c12" marker-end="url(#arrowhead-orange)" />
            <!-- Main to Hybrid -->
            <line class="connection-line" x1="25%" y1="50%" x2="25%" y2="68%" stroke="#9b59b6" marker-end="url(#arrowhead-purple)" />
            <!-- Partner A to Partner B -->
            <line class="connection-line" x1="85%" y1="42%" x2="85%" y2="65%" stroke="#95a5a6" stroke-dasharray="5,5" marker-end="url(#arrowhead-gray)" />
        </svg>
    </div>

    <!-- Modal for detailed views -->
    <div class="modal-overlay" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Organization Details</h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Dynamic content will be loaded here -->
            </div>
        </div>
    </div>

    <div class="legend">
        <h4>🎯 Click any section to explore:</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #3498db;"></div>
            <span><strong>Main Organization:</strong> Multi-region AWS accounts</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #e74c3c;"></div>
            <span><strong>Partner Org A:</strong> External service providers</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #f39c12;"></div>
            <span><strong>Partner Org B:</strong> Logistics & supply chain</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #9b59b6;"></div>
            <span><strong>Hybrid Cloud:</strong> On-premises integration</span>
        </div>
    </div>

    <div class="zoom-controls" id="zoom-controls" style="display: none;">
        <button class="zoom-btn" onclick="zoomIn()">+</button>
        <button class="zoom-btn" onclick="zoomOut()">−</button>
        <button class="zoom-btn" onclick="resetZoom()" style="font-size: 14px;">⌂</button>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // Detailed data for each organization
        const organizationData = {
            'main-org': {
                title: '🏢 Main Organization - Multi-Region Architecture',
                description: 'Enterprise AWS deployment across three regions with comprehensive account structure',
                nodes: [
                    // US-East-1 Region
                    { id: 'shared-services-us', name: 'Shared Services US', type: 'core', region: 'US-East-1', cost: '$162/month', traffic: '1,200 GB', x: 200, y: 150 },
                    { id: 'security-us', name: 'Security & Compliance', type: 'security', region: 'US-East-1', cost: '$206/month', traffic: '600 GB', x: 350, y: 120 },
                    { id: 'production-us', name: 'Production US', type: 'production', region: 'US-East-1', cost: '$850/month', traffic: '5,000 GB', x: 500, y: 180 },
                    { id: 'client-fintech', name: 'FinTech Client', type: 'client', region: 'US-East-1', cost: '$182/month', traffic: '3,200 GB', x: 350, y: 250 },
                    { id: 'client-retail', name: 'Retail Client', type: 'client', region: 'US-East-1', cost: '$228/month', traffic: '2,800 GB', x: 500, y: 300 },
                    { id: 'reporting-us', name: 'Reporting & BI', type: 'reporting', region: 'US-East-1', cost: '$645/month', traffic: '4,500 GB', x: 200, y: 300 },
                    { id: 's3-primary', name: 'S3 Primary', type: 's3', region: 'US-East-1', cost: 'FREE via Gateway', traffic: '8,000 GB', x: 400, y: 180 },
                    { id: 'api-gateway', name: 'API Gateway', type: 'api', region: 'US-East-1', cost: '$415/month', traffic: '3,500 GB', x: 450, y: 120 },

                    // EU-West-1 Region  
                    { id: 'shared-services-eu', name: 'Shared Services EU', type: 'core', region: 'EU-West-1', cost: '$209/month', traffic: '900 GB', x: 700, y: 150 },
                    { id: 'production-eu', name: 'Production EU', type: 'production', region: 'EU-West-1', cost: '$335/month', traffic: '3,500 GB', x: 850, y: 200 },
                    { id: 'client-automotive', name: 'Auto Manufacturer', type: 'client', region: 'EU-West-1', cost: '$202/month', traffic: '2,200 GB', x: 750, y: 250 },
                    { id: 'client-pharma', name: 'Pharma Research', type: 'client', region: 'EU-West-1', cost: '$268/month', traffic: '1,800 GB', x: 850, y: 300 },
                    { id: 'reporting-eu', name: 'Analytics EU', type: 'reporting', region: 'EU-West-1', cost: '$428/month', traffic: '2,800 GB', x: 700, y: 300 },

                    // AP-Southeast-1 Region
                    { id: 'production-apac', name: 'Production APAC', type: 'production', region: 'AP-Southeast-1', cost: '$321/month', traffic: '2,100 GB', x: 200, y: 450 },
                    { id: 'client-gaming', name: 'Gaming Studio', type: 'client', region: 'AP-Southeast-1', cost: '$542/month', traffic: '4,200 GB', x: 350, y: 450 },
                    { id: 'client-ecommerce', name: 'E-commerce Platform', type: 'client', region: 'AP-Southeast-1', cost: '$438/month', traffic: '3,800 GB', x: 500, y: 450 },

                    // Global Services
                    { id: 'cloudfront', name: 'CloudFront CDN', type: 'global', region: 'Global', cost: '$1,475/month', traffic: '15,000 GB', x: 450, y: 50 },
                    { id: 'transit-gateway', name: 'Transit Gateway', type: 'network', region: 'US-East-1', cost: '$278/month', traffic: '8,500 GB', x: 300, y: 180 }
                ],
                links: [
                    // Cross-account connections
                    { source: 'production-us', target: 'reporting-us', cost: '$30/month', type: 'cross-account' },
                    { source: 'client-fintech', target: 'reporting-us', cost: '$15/month', type: 'cross-account' },
                    { source: 'client-retail', target: 'reporting-us', cost: '$12/month', type: 'cross-account' },
                    { source: 'production-us', target: 's3-primary', cost: 'FREE', type: 'gateway-endpoint' },
                    { source: 'api-gateway', target: 'production-us', cost: '$25/month', type: 'api-backend' },
                    { source: 'api-gateway', target: 'cloudfront', cost: '$298/month', type: 'cdn-distribution' },
                    
                    // Cross-region connections
                    { source: 'production-us', target: 'production-eu', cost: '$18/month', type: 'cross-region' },
                    { source: 'reporting-us', target: 'reporting-eu', cost: '$16/month', type: 'cross-region' },
                    { source: 'production-apac', target: 'reporting-us', cost: '$24/month', type: 'cross-region' },
                    
                    // EU internal connections
                    { source: 'shared-services-eu', target: 'production-eu', cost: '$9/month', type: 'cross-account' },
                    { source: 'production-eu', target: 'reporting-eu', cost: '$20/month', type: 'cross-account' },
                    { source: 'client-automotive', target: 'production-eu', cost: '$22/month', type: 'cross-account' },
                    
                    // APAC connections
                    { source: 'production-apac', target: 'client-gaming', cost: '$42/month', type: 'cross-account' },
                    { source: 'production-apac', target: 'client-ecommerce', cost: '$38/month', type: 'cross-account' },
                    
                    // Transit Gateway connections
                    { source: 'shared-services-us', target: 'transit-gateway', cost: '$24/month', type: 'transit' },
                    { source: 'production-us', target: 'transit-gateway', cost: '$100/month', type: 'transit' },
                    { source: 'reporting-us', target: 'transit-gateway', cost: '$90/month', type: 'transit' }
                ]
            },
            
            'partner-org-1': {
                title: '🤝 Partner Organization A - External Service Providers',
                description: 'External partner organization providing financial and analytics services',
                nodes: [
                    { id: 'partner-fintech', name: 'FinTech Services', type: 'external', region: 'External', cost: '$218/month', traffic: '1,500 GB', x: 300, y: 200 },
                    { id: 'partner-analytics', name: 'Analytics Provider', type: 'external', region: 'External', cost: '$162/month', traffic: '800 GB', x: 500, y: 200 },
                    { id: 'main-org-connection', name: 'Main Org Gateway', type: 'gateway', region: 'Cross-Org', cost: '$30/month', traffic: '2,300 GB', x: 400, y: 300 }
                ],
                links: [
                    { source: 'partner-fintech', target: 'main-org-connection', cost: '$18/month', type: 'cross-org' },
                    { source: 'partner-analytics', target: 'main-org-connection', cost: '$12/month', type: 'cross-org' }
                ]
            },
            
            'partner-org-2': {
                title: '🚚 Partner Organization B - Logistics & Supply Chain',
                description: 'Supply chain partner with hybrid cloud integration',
                nodes: [
                    { id: 'logistics-hub', name: 'Logistics Hub', type: 'logistics', region: 'Hybrid', cost: '$112/month', traffic: '600 GB', x: 300, y: 200 },
                    { id: 'partner-datacenter', name: 'Partner Data Center', type: 'onprem', region: 'On-Premises', cost: '$86/month', traffic: '400 GB', x: 500, y: 200 },
                    { id: 'supply-chain-api', name: 'Supply Chain APIs', type: 'api', region: 'Integration', cost: '$100/month', traffic: '600 GB', x: 400, y: 300 }
                ],
                links: [
                    { source: 'partner-datacenter', target: 'logistics-hub', cost: '$36/month', type: 'partner-vpn' },
                    { source: 'logistics-hub', target: 'supply-chain-api', cost: '$12/month', type: 'partner-integration' }
                ]
            },
            
            'hybrid-cloud': {
                title: '☁️ Hybrid Cloud Infrastructure',
                description: 'On-premises integration with AWS cloud services',
                nodes: [
                    { id: 'corporate-hq', name: 'Corporate HQ', type: 'onprem', region: 'On-Premises', cost: '$550/month', traffic: '2,500 GB', x: 200, y: 200 },
                    { id: 'branch-offices', name: 'Branch Offices (5)', type: 'onprem', region: 'On-Premises', cost: '$222/month', traffic: '800 GB', x: 400, y: 150 },
                    { id: 'direct-connect', name: 'Direct Connect', type: 'network', region: 'Hybrid', cost: '$1,720/month', traffic: '5,000 GB', x: 300, y: 250 },
                    { id: 'vpn-hub', name: 'VPN Hub', type: 'network', region: 'Hybrid', cost: '$288/month', traffic: '1,200 GB', x: 500, y: 250 },
                    { id: 'aws-gateway', name: 'AWS Gateway', type: 'gateway', region: 'AWS', cost: '$158/month', traffic: '3,700 GB', x: 350, y: 350 }
                ],
                links: [
                    { source: 'corporate-hq', target: 'direct-connect', cost: '$50/month', type: 'direct-connect' },
                    { source: 'branch-offices', target: 'vpn-hub', cost: '$72/month', type: 'vpn' },
                    { source: 'direct-connect', target: 'aws-gateway', cost: '$50/month', type: 'hybrid-primary' },
                    { source: 'vpn-hub', target: 'aws-gateway', cost: '$108/month', type: 'hybrid-backup' }
                ]
            }
        };

        // Color schemes for different node types
        const colors = {
            'core': '#2c3e50',
            'security': '#e67e22', 
            'production': '#3498db',
            'client': '#3498db',
            'reporting': '#27ae60',
            's3': '#f39c12',
            'api': '#f39c12',
            'external': '#95a5a6',
            'logistics': '#f39c12',
            'onprem': '#8e44ad',
            'network': '#e67e22',
            'gateway': '#27ae60',
            'global': '#e74c3c'
        };

        const linkColors = {
            'cross-account': '#2ecc71',
            'gateway-endpoint': '#27ae60',
            'api-backend': '#3498db',
            'cdn-distribution': '#f39c12',
            'cross-region': '#e67e22',
            'transit': '#3498db',
            'cross-org': '#9b59b6',
            'partner-vpn': '#9b59b6',
            'partner-integration': '#95a5a6',
            'direct-connect': '#e67e22',
            'vpn': '#e74c3c',
            'hybrid-primary': '#f39c12',
            'hybrid-backup': '#e74c3c'
        };

        let currentModal = null;
        let modalSvg = null;
        let modalSimulation = null;

        // Show organization details in modal
        function showOrgDetails(orgId) {
            const orgData = organizationData[orgId];
            if (!orgData) return;

            const modal = document.getElementById('modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.textContent = orgData.title;
            body.innerHTML = '';

            // Create SVG for the detailed diagram
            const svg = d3.select(body)
                .append('svg')
                .attr('width', '100%')
                .attr('height', '100%')
                .style('background', 'linear-gradient(135deg, #34495e 0%, #2c3e50 100%)');

            modalSvg = svg;
            currentModal = orgId;

            // Add zoom behavior
            const zoom = d3.zoom()
                .scaleExtent([0.5, 3])
                .on('zoom', (event) => {
                    container.attr('transform', event.transform);
                });

            svg.call(zoom);

            // Main container
            const container = svg.append('g');

            // Create force simulation for modal content
            modalSimulation = d3.forceSimulation(orgData.nodes)
                .force('link', d3.forceLink(orgData.links).id(d => d.id).distance(120).strength(0.8))
                .force('charge', d3.forceManyBody().strength(-600).distanceMax(400))
                .force('center', d3.forceCenter(400, 300).strength(0.1))
                .force('collision', d3.forceCollide().radius(35).strength(0.9))
                .alphaDecay(0.15)
                .velocityDecay(0.95);

            // Create links
            const links = container.append('g')
                .selectAll('line')
                .data(orgData.links)
                .join('line')
                .attr('class', 'link')
                .attr('stroke', d => linkColors[d.type] || '#95a5a6')
                .style('stroke-dasharray', d => d.type === 'vpn' ? '5,5' : 'none');

            // Create link labels
            const linkLabels = container.append('g')
                .selectAll('text')
                .data(orgData.links)
                .join('text')
                .attr('class', 'cost-label')
                .text(d => d.cost)
                .style('font-size', '9px');

            // Create nodes
            const nodes = container.append('g')
                .selectAll('circle')
                .data(orgData.nodes)
                .join('circle')
                .attr('class', 'node')
                .attr('r', d => d.type === 'global' ? 25 : 20)
                .attr('fill', d => colors[d.type] || '#95a5a6')
                .attr('stroke', '#fff')
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));

            // Create node labels
            const nodeLabels = container.append('g')
                .selectAll('text')
                .data(orgData.nodes)
                .join('text')
                .attr('class', 'node-label')
                .text(d => d.name)
                .style('font-size', '10px');

            // Add event handlers
            nodes.on('click', handleNodeClick)
                .on('mouseover', handleMouseOver)
                .on('mouseout', handleMouseOut);

            links.on('click', handleLinkClick)
                .on('mouseover', handleLinkMouseOver)
                .on('mouseout', handleMouseOut);

            // Update positions on simulation tick
            modalSimulation.on('tick', () => {
                links
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);

                linkLabels
                    .attr('x', d => (d.source.x + d.target.x) / 2)
                    .attr('y', d => (d.source.y + d.target.y) / 2);

                nodes
                    .attr('cx', d => d.x)
                    .attr('cy', d => d.y);

                nodeLabels
                    .attr('x', d => d.x)
                    .attr('y', d => d.y + 30);
            });

            // Stop simulation after it settles to prevent wiggling
            setTimeout(() => {
                if (modalSimulation) {
                    modalSimulation.alphaTarget(0).restart();
                    setTimeout(() => {
                        if (modalSimulation) modalSimulation.stop();
                    }, 2000);
                }
            }, 3000);

            modal.style.display = 'flex';
            document.getElementById('zoom-controls').style.display = 'flex';
        }

        // Event handlers
        function handleNodeClick(event, d) {
            clearHighlights();
            highlightNode(d);
            event.stopPropagation();
        }

        function handleLinkClick(event, d) {
            clearHighlights();
            highlightLink(d);
            event.stopPropagation();
        }

        let isDragging = false;
        let tooltipTimeout = null;
        let tooltipDebounce = null;

        function handleMouseOver(event, d) {
            // Only show tooltip if not currently dragging
            if (!isDragging) {
                // Clear any existing timeouts
                if (tooltipTimeout) {
                    clearTimeout(tooltipTimeout);
                }
                if (tooltipDebounce) {
                    clearTimeout(tooltipDebounce);
                }
                // Add debounce delay to prevent rapid flashing
                tooltipDebounce = setTimeout(() => {
                    if (!isDragging) {
                        showTooltip(event, d);
                    }
                }, 200);
            }
        }

        function handleLinkMouseOver(event, d) {
            // Only show tooltip if not currently dragging
            if (!isDragging) {
                // Clear any existing timeouts
                if (tooltipTimeout) {
                    clearTimeout(tooltipTimeout);
                }
                if (tooltipDebounce) {
                    clearTimeout(tooltipDebounce);
                }
                // Add debounce delay to prevent rapid flashing
                tooltipDebounce = setTimeout(() => {
                    if (!isDragging) {
                        showTooltip(event, d, 'link');
                    }
                }, 200);
            }
        }

        function handleMouseOut() {
            // Clear all timeouts and hide tooltip
            if (tooltipTimeout) {
                clearTimeout(tooltipTimeout);
                tooltipTimeout = null;
            }
            if (tooltipDebounce) {
                clearTimeout(tooltipDebounce);
                tooltipDebounce = null;
            }
            hideTooltip();
        }

        function clearHighlights() {
            if (!modalSvg) return;
            modalSvg.selectAll('.node').classed('highlighted', false);
            modalSvg.selectAll('.link').classed('highlighted', false);
        }

        function highlightNode(selectedNode) {
            if (!modalSvg) return;
            modalSvg.selectAll('.node').classed('highlighted', d => d.id === selectedNode.id);
            modalSvg.selectAll('.link').classed('highlighted', d => 
                d.source.id === selectedNode.id || d.target.id === selectedNode.id
            );
        }

        function highlightLink(selectedLink) {
            if (!modalSvg) return;
            modalSvg.selectAll('.link').classed('highlighted', d => d === selectedLink);
            modalSvg.selectAll('.node').classed('highlighted', d => 
                d.id === selectedLink.source.id || d.id === selectedLink.target.id
            );
        }

        function showTooltip(event, d, type = 'node') {
            const tooltip = document.getElementById('tooltip');
            const content = type === 'link' ? 
                `<h4>${d.source.name} → ${d.target.name}</h4>
                 <p><strong>Type:</strong> ${d.type.replace('-', ' ')}</p>
                 <p><strong>Monthly Cost:</strong> ${d.cost}</p>` :
                `<h4>${d.name}</h4>
                 <p><strong>Region:</strong> ${d.region}</p>
                 <p><strong>Traffic:</strong> ${d.traffic}</p>
                 <div class="cost">Cost: ${d.cost}</div>`;
            
            tooltip.innerHTML = content;
            tooltip.classList.add('visible');
            tooltip.style.left = (event.pageX + 10) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
        }

        function hideTooltip() {
            document.getElementById('tooltip').classList.remove('visible');
        }

        // Drag functions
        function dragstarted(event, d) {
            // Set dragging state to prevent tooltip conflicts
            isDragging = true;
            
            // Clear any pending tooltip timeouts
            if (tooltipTimeout) {
                clearTimeout(tooltipTimeout);
                tooltipTimeout = null;
            }
            if (tooltipDebounce) {
                clearTimeout(tooltipDebounce);
                tooltipDebounce = null;
            }
            
            // Hide tooltip during drag
            hideTooltip();
            // Disable pointer events on tooltip to prevent interference
            document.getElementById('tooltip').style.pointerEvents = 'none';
            
            if (!event.active && modalSimulation) modalSimulation.alphaTarget(0.05).restart();
            d.fx = d.x;
            d.fy = d.y;
            
            // Add dragging class for visual feedback
            d3.select(this).classed('dragging', true);
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            // Clear dragging state
            isDragging = false;
            
            // Re-enable tooltip pointer events
            document.getElementById('tooltip').style.pointerEvents = 'auto';
            
            if (!event.active && modalSimulation) {
                modalSimulation.alphaTarget(0);
                // Stop simulation after drag ends to prevent continued wiggling
                setTimeout(() => {
                    if (modalSimulation) modalSimulation.stop();
                }, 1000);
            }
            d.fx = null;
            d.fy = null;
            
            // Remove dragging class
            d3.select(this).classed('dragging', false);
        }

        // Modal controls
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('zoom-controls').style.display = 'none';
            if (modalSimulation) {
                modalSimulation.stop();
                modalSimulation = null;
            }
            modalSvg = null;
            currentModal = null;
        }

        function zoomIn() {
            if (modalSvg) {
                modalSvg.transition().call(d3.zoom().scaleBy, 1.5);
            }
        }

        function zoomOut() {
            if (modalSvg) {
                modalSvg.transition().call(d3.zoom().scaleBy, 1 / 1.5);
            }
        }

        function resetZoom() {
            if (modalSvg) {
                modalSvg.transition().call(d3.zoom().transform, d3.zoomIdentity);
            }
        }

        function showCostAnalysis() {
            // Calculate total costs across all organizations
            let totalCost = 0;
            let totalTraffic = 0;
            let accountCount = 0;
            let connectionCount = 0;

            Object.values(organizationData).forEach(org => {
                org.nodes.forEach(node => {
                    accountCount++;
                    const cost = parseFloat(node.cost.replace(/[^0-9.]/g, '')) || 0;
                    totalCost += cost;
                    const traffic = parseFloat(node.traffic.replace(/[^0-9.]/g, '')) || 0;
                    totalTraffic += traffic;
                });
                connectionCount += org.links.length;
            });

            alert(`🏗️ Enterprise Architecture Cost Analysis

💰 Total Monthly Costs: $${totalCost.toFixed(2)}
📊 Annual Projection: $${(totalCost * 12).toFixed(2)}
📈 Total Traffic: ${totalTraffic.toLocaleString()} GB/month
🏢 Total Accounts: ${accountCount}
🔗 Total Connections: ${connectionCount}

💡 Top Cost Savings Opportunities:
• VPC Gateway Endpoints: FREE S3/DynamoDB access
• CloudFront CDN: 5-15% egress cost reduction  
• Direct Connect: 80% savings vs VPN for high-volume
• Regional Optimization: Minimize cross-region transfers`);
        }

        function showAllConnections() {
            // This could show a comprehensive view of all inter-organization connections
            alert(`🔗 Inter-Organization Connections Overview

🏢 Main Org ↔️ Partner Org A: $30/month
   • FinTech payment processing integration
   • Advanced analytics and ML services

🏢 Main Org ↔️ Partner Org B: $48/month  
   • Supply chain data integration
   • Logistics and tracking APIs

🏢 Main Org ↔️ Hybrid Cloud: $158/month
   • Corporate HQ Direct Connect
   • 5 Branch office VPN connections

📊 Total Cross-Organization: $236/month
🔄 Total Monthly Data Transfer: $1,483/month`);
        }

        // Handle escape key to close modal
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && currentModal) {
                closeModal();
            }
        });

        // Close modal when clicking outside content
        document.getElementById('modal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>